<!DOCTYPE html>
<html lang="en">
  <head id="head">
    <meta charset="utf-8">
    <title id="title">
      Exploring Gleam through Advent of Code
      | Adam CL
    </title>
    <meta name="description" content="I&apos;ve explored the young programming language Gleam by doing Advent of Code 2016 using it. This post outlines my thoughts about Gleam so far, but is quite limited to the AoC single-problem perspective.">
    <meta property="og:title" content="Exploring Gleam through Advent of Code">
    <meta property="og:type" content="website">
    <!-- <meta
    property="og:image"
    content="$site.host_url.addPath($site.asset('logo.png').link())"
  > -->
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link type="text/css" rel="stylesheet" href="/reset.css?bust">
    <link type="text/css" rel="stylesheet" href="/main.css?bust2">
    <link type="text/css" rel="stylesheet" href="/highlight.css?bust">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=EB+Garamond">
    <!-- <script defer type="text/javascript" src="https://api.pirsch.io/pirsch.js" id="pirschjs" data-code="CnorXJVVDmhCee3FBtXSQISdHIUmqp3o"></script> -->
    
  <link type="text/css" rel="stylesheet" href="/term-highlight.css">

  </head>
  <body>
    <script>

      /**
       * Implements a tri-state theme switch (i.e. light/dark mode) allowing an
       * explicit setting of one or the other, or inheriting the operating system's
       * default and styling accordingly.
       * 
       * The reason this is in a template file as opposed to a separate JavaScript is
       * so that it's parsed inline with the HTML body and given a chance to run
       * before the page is rendered, thereby avoiding the common pitfall of briefly
       * "flashing" the wrong theme when the page initially loads. Under this
       * framework, there's one initial call to `setThemeFromLocalStorage()` inline,
       * so the theme always appears correct on first render.
       */
      
      const LOCAL_STORAGE_KEY_THEME = 'theme';
      
      const THEME_VALUE_AUTO  = 'auto';
      const THEME_VALUE_DARK  = 'dark';
      const THEME_VALUE_LIGHT = 'light';
      
      const THEME_CLASS_DARK            = 'dark';           // activates dark mode styling
      const THEME_CLASS_DARK_OVERRIDE   = 'dark_override';  // slides toggle to dark mode
      const THEME_CLASS_LIGHT           = 'light';          // here for consistency, but has no real effect
      const THEME_CLASS_LIGHT_OVERRIDE  = 'light_override'; // slides toggle to light mode
      
      const THEME_CLASS_ALL = Object.freeze([
          THEME_CLASS_DARK,
          THEME_CLASS_DARK_OVERRIDE,
          THEME_CLASS_LIGHT,
          THEME_CLASS_LIGHT_OVERRIDE,
      ])
      
      function setDocumentClasses(...classes) {
          THEME_CLASS_ALL.forEach((themeClass) => {
              if (classes.includes(themeClass)) {
                  document.documentElement.classList.add(themeClass)
              } else {
                  document.documentElement.classList.remove(themeClass)
              }
          })
      }
      
      // Sets light or dark mode based on a preference from local storage, or if none
      // is set there, sets based on preference from `prefers-color-scheme` CSS.
      function setThemeFromLocalStorageOrMediaPreference() {
          const theme = localStorage.getItem(LOCAL_STORAGE_KEY_THEME) || THEME_VALUE_AUTO
      
          switch (theme) {
              case THEME_VALUE_AUTO:
                  if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                      setDocumentClasses(THEME_CLASS_DARK)
                  } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
                      setDocumentClasses(THEME_CLASS_LIGHT)
                  }
                  break
      
              case THEME_VALUE_DARK:
                  setDocumentClasses(THEME_CLASS_DARK, THEME_CLASS_DARK_OVERRIDE)
                  break
      
              case THEME_VALUE_LIGHT:
                  setDocumentClasses(THEME_CLASS_LIGHT, THEME_CLASS_LIGHT_OVERRIDE)
                  break
          }
      
          console.log(`theme is: ${theme}`)
      
          document.querySelectorAll(`.theme_toggle input[value='${theme}']`).forEach((toggle) => {
          console.log(`set toggle`)
              toggle.checked = true;
          })
      }
      
      // See comment above, but this call must be made inline to avoid briefly
      // flashing the wrong theme on initial page load.
      setThemeFromLocalStorageOrMediaPreference()
      
      // Runs on initial page load. Add change listeners to light/dark toggles that
      // set a local storage key and trigger a theme change.
      window.addEventListener('DOMContentLoaded', () => {
          document.querySelectorAll('.theme_toggle input').forEach((toggle) => {
              toggle.addEventListener('change', (e) => {
                  if (e.target.checked) {
                      if (e.target.value == THEME_VALUE_AUTO) {
                          localStorage.removeItem(LOCAL_STORAGE_KEY_THEME)
                      } else {
                          localStorage.setItem(LOCAL_STORAGE_KEY_THEME, e.target.value)
                      }
                  }
      
                  setThemeFromLocalStorageOrMediaPreference()
              }, false)
          })
      
          // We already our theme "early" to avoid a flash that would occur if we only
          // set it here on content loaded, but set it one more time so that we set
          // the theme toggle to the appropriate value. It's not loaded yet when we
          // set the theme the first time.
          setThemeFromLocalStorageOrMediaPreference()
      })
      
      // Listen for local storage changes on our theme key. This allows one tab to be
      // notified if the theme is changed in another and update itself accordingly.
      window.addEventListener("storage", (e) => {
          if (e.key == LOCAL_STORAGE_KEY_THEME) {
              setThemeFromLocalStorageOrMediaPreference()
          }
      })
      
      // Watch for OS-level changes in preference for light/dark mode. This will
      // trigger for example if a user explicitly changes their OS-level light/dark
      // configuration, or on sunrise/sunset if they have it set to automatic.
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
          setThemeFromLocalStorageOrMediaPreference()
      })
      
      </script>
    <div id="content">
      
  
  <h1>Exploring Gleam through Advent of Code</h1>
  <p class="post-byline">
    <span>November 11, 2024</span>
    <span></span>
    •
    <span>3</span>
    min read • by
    <b>Adam CL</b>
    <span></span>
  </p>
  <div id="post-description">I've explored the young programming language Gleam by doing Advent of Code 2016 using it. This post outlines my thoughts about Gleam so far, but is quite limited to the AoC single-problem perspective.</div>
  <details><summary>Contents</summary><div><ul>
<li>
<ul><li>
<a href="#intro"><a href="#intro">Quick Intro to Gleam</a></li><li><a href="#why"><a href="#why">Why I Chose Gleam</a></li><li><a href="#first-impressions"><a href="#first-impressions">First Impressions</a><ul><li>
<a href="#first-miss"><a href="#first-miss">Missed Functionality #1 - list access by index</a></li></ul></li></ul></ul></div></details>
  <div id="post-body"><div id=intro><h2><a class="" href="#intro">Quick Intro to Gleam</a></h2><p><a href="https://gleam.run" target="_blank">Gleam</a> is a statically typed functional programming language that gets compiled to either <a href="https://en.wikipedia.org/wiki/BEAM_(Erlang_virtual_machine)" target="_blank">BEAM</a> or JavaScript. Its syntax is more akin to <a href="https://rust-lang.org" target="_blank">Rust</a> than other BEAM languages such as <a href="https://elixir-lang.org" target="_blank">Elixir</a> and <a href="https://erlang.org" target="_blank">Erlang</a>.</p><pre><code class="gleam"><span class="comment">// gleam</span>

<span class="keyword">pub</span> <span class="keyword">fn</span> <span class="function">split</span><span class="punctuation bracket">(</span><span class="variable parameter">x</span><span class="punctuation delimiter">:</span> <span class="type">String</span><span class="punctuation delimiter">,</span> <span class="property">on</span> <span class="variable parameter">substring</span><span class="punctuation delimiter">:</span> <span class="type">String</span><span class="punctuation bracket">)</span> <span class="punctuation delimiter">-&gt;</span> <span class="type">List</span><span class="punctuation bracket">(</span><span class="type">String</span><span class="punctuation bracket">)</span> <span class="punctuation bracket">{</span>
  <span class="keyword">case</span> <span class="error">substring</span> <span class="punctuation bracket">{</span>
    <span class="string">&quot;&quot;</span> <span class="punctuation delimiter">-&gt;</span> <span class="function">to_graphemes</span><span class="punctuation bracket">(</span><span class="error">x</span><span class="punctuation bracket">)</span>
    <span class="comment unused">_</span> <span class="punctuation delimiter">-&gt;</span>
      <span class="error">x</span>
      <span class="operator">|&gt;</span> <span class="error">string_builder</span><span class="punctuation delimiter">.</span><span class="function">from_string</span>
      <span class="operator">|&gt;</span> <span class="error">string_builder</span><span class="punctuation delimiter">.</span><span class="function">split</span><span class="punctuation bracket">(</span><span class="property">on</span><span class="punctuation delimiter">:</span> <span class="error">substring</span><span class="punctuation bracket">)</span>
      <span class="operator">|&gt;</span> <span class="error">list</span><span class="punctuation delimiter">.</span><span class="function">map</span><span class="punctuation bracket">(</span><span class="property">with</span><span class="punctuation delimiter">:</span> <span class="error">string_builder</span><span class="punctuation delimiter">.</span><span class="function">to_string</span><span class="punctuation bracket">)</span>
  <span class="punctuation bracket">}</span>
<span class="punctuation bracket">}</span>
</code></pre>
</div><div id=why><h2><a class="" href="#why">Why I Chose Gleam</a></h2><p>First and foremost, I wanted to try something new. Gleam ticked quite a few of the boxes of things I like in a language:</p><ul><li>Static type system</li><li>Immutability</li><li>Compiled</li><li>Built-in tooling</li><li>Decent standard library</li></ul><p>For the purpose of AoC, it’s mainly the type system, tooling and standard library I’m choosing Gleam. I might take on doing something more complicated (and distributed) afterwards.</p></div><div id=first-impressions><h2><a class="" href="#first-impressions">First Impressions</a></h2><p>As I usually work in procedural languages, getting into the strictly functional paradigm has been the biggest hurdle. Don’t get me wrong - I often use the functional style functions of JS, but due to its mutability and dynamic typing, it’s far from Gleam. I’ve previously delved into Elixir, and while it is also functional it’s got the dynamic typing to make it less of a jump. After completing the first 8 days of AoC, I’m getting used to it and I see the light that is immutability. In the codebase I spend most time in at work, there’s plenty of functionality that modifies in-place, causing both confusion and bugs for developers who are new to the code.</p></div><div id=first-miss><h3><a class="" href="#first-miss">Missed Functionality #1 - list access by index</a></h3><p>When it comes to AoC, it’s very common to work with arrays/lists, for instance in a matrix:</p><pre><code class="python"><span class="comment"># python</span>

<span class="variable">matrix</span> <span class="operator">=</span> [[<span class="string">&apos;a&apos;</span>, <span class="string">&apos;b&apos;</span>], [<span class="string">&apos;c&apos;</span>, <span class="string">&apos;d&apos;</span>]]
<span class="variable">matrix</span>[<span class="number">0</span>][<span class="number">0</span>] <span class="comment"># &apos;a&apos;</span>
</code></pre>
<p>Let’s say then that a task requires shifting rows by 1:</p><pre><code class="python"><span class="comment"># python</span>

<span class="keyword">def</span> <span class="function">shift_row_right</span>(<span class="variable">matrix</span>, <span class="variable">row_index</span>, <span class="variable">n</span>):
    <span class="variable">row</span> <span class="operator">=</span> <span class="variable">matrix</span>[<span class="variable">row_index</span>]
    <span class="variable">n</span> <span class="operator">=</span> <span class="variable">n</span> <span class="operator">%</span> <span class="function">len</span>(<span class="variable">row</span>)
    <span class="variable">shifted_row</span> <span class="operator">=</span> <span class="variable">row</span>[<span class="operator">-</span><span class="variable">n</span>:] <span class="operator">+</span> <span class="variable">row</span>[:<span class="operator">-</span><span class="variable">n</span>]
    <span class="variable">matrix</span>[<span class="variable">row_index</span>] <span class="operator">=</span> <span class="variable">shifted_row</span>
    <span class="keyword">return</span> <span class="variable">matrix</span>

<span class="function">shift_row_right</span>(<span class="variable">matrix</span>, <span class="number">0</span>, <span class="number">1</span>) <span class="comment"># [[&apos;b&apos;, &apos;a&apos;], [&apos;c&apos;, &apos;d&apos;]]</span>
</code></pre>
<p>Performance aside, this is a very simple and neat way of accessing elements in a list. There’s no need to iterate over the rows. In Gleam, you can’t access lists by index. Instead, you have to iterate through the list until you’re on the right index. Pairing this with the immutability means that shifting rows as above is a bit more tedious. For AoC 2016 day 8, this was the solution I came up with for shifting rows with wrap around:</p><pre><code class="gleam"><span class="comment">// gleam</span>

<span class="keyword">pub</span> <span class="keyword">fn</span> <span class="function">shift_row_right</span><span class="punctuation bracket">(</span>
  <span class="variable parameter">matrix</span><span class="punctuation delimiter">:</span> <span class="type">Matrix</span><span class="punctuation bracket">(</span>value<span class="punctuation bracket">)</span><span class="punctuation delimiter">,</span>
  <span class="variable parameter">row</span><span class="punctuation delimiter">:</span> <span class="type">Int</span><span class="punctuation delimiter">,</span>
  <span class="variable parameter">shift</span><span class="punctuation delimiter">:</span> <span class="type">Int</span><span class="punctuation delimiter">,</span>
<span class="punctuation bracket">)</span> <span class="punctuation delimiter">-&gt;</span> <span class="type">Matrix</span><span class="punctuation bracket">(</span>value<span class="punctuation bracket">)</span> <span class="punctuation bracket">{</span>
  <span class="constructor">Matrix</span><span class="punctuation bracket">(</span>
    <span class="property">cells</span><span class="punctuation delimiter">:</span> <span class="error">list</span><span class="punctuation delimiter">.</span><span class="function">index_map</span><span class="punctuation bracket">(</span><span class="error">matrix</span><span class="punctuation delimiter">.</span><span class="function">cells</span><span class="punctuation delimiter">,</span> <span class="keyword">fn</span><span class="punctuation bracket">(</span><span class="variable parameter">current_row</span><span class="punctuation delimiter">,</span> <span class="variable parameter">row_index</span><span class="punctuation bracket">)</span> <span class="punctuation bracket">{</span>
      <span class="keyword">case</span> <span class="error">row_index</span> <span class="operator">==</span> <span class="error">row</span> <span class="punctuation bracket">{</span>
        <span class="constructor">True</span> <span class="punctuation delimiter">-&gt;</span> <span class="punctuation bracket">{</span>
          <span class="error">current_row</span>
          <span class="operator">|&gt;</span> <span class="error">list</span><span class="punctuation delimiter">.</span><span class="function">split</span><span class="punctuation bracket">(</span><span class="error">list</span><span class="punctuation delimiter">.</span><span class="function">length</span><span class="punctuation bracket">(</span><span class="error">current_row</span><span class="punctuation bracket">)</span> <span class="operator">-</span> <span class="error">shift</span><span class="punctuation bracket">)</span>
          <span class="operator">|&gt;</span> <span class="keyword">fn</span><span class="punctuation bracket">(</span><span class="variable parameter">split</span><span class="punctuation bracket">)</span> <span class="punctuation bracket">{</span> <span class="error">list</span><span class="punctuation delimiter">.</span><span class="function">append</span><span class="punctuation bracket">(</span><span class="error">split</span><span class="punctuation delimiter">.</span><span class="property">1</span><span class="punctuation delimiter">,</span> <span class="error">split</span><span class="punctuation delimiter">.</span><span class="property">0</span><span class="punctuation bracket">)</span> <span class="punctuation bracket">}</span>
        <span class="punctuation bracket">}</span>
        <span class="constructor">False</span> <span class="punctuation delimiter">-&gt;</span> <span class="error">current_row</span>
      <span class="punctuation bracket">}</span>
    <span class="punctuation bracket">}</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">,</span>
  <span class="punctuation bracket">)</span>
<span class="punctuation bracket">}</span>
</code></pre>
<p>We first have to iterate through all the rows, and in case of being on the wrong row we just return it as is. In case of being on the right row, we then need to construct a new row by iterating over the row, first to split it and then over the first part of the new list (<code>split.1</code>) in the <code>list.append</code> function.</p></div></div>
  <hr>
  <div id="prev-next">
    <span>
      <a href="/articles/zine/">←
        <span>Setting up a site with Zine</span></a>
    </span>
    <span></span>
    <span></span>
    <small>&nbsp; or &nbsp;</small>
    <small>
      <a href="/">Back to the Homepage</a>
    </small>
  </div>

    </div>
  </body>
</html>