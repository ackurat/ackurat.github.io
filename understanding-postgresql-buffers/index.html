<!DOCTYPE html>
  <html lang="en">
    <head>
      <meta charset="utf-8">
      <title>Understanding PostgreSQL and its buffers — ackurat.github.io</title>
      <meta name="description" content="PostgreSQL&#39;s buffer cache plays a crucial role in maintaining high performance. In this article, I conduct some experiments and show how the buffer cache affects performance.">
      <meta name="author" content="Adam CL">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link href="/index.xml" rel="alternate" type="application/rss+xml" title="ackurat.github.io">
      <meta name="ROBOTS" content="INDEX, FOLLOW">
      <meta property="og:title" content="Understanding PostgreSQL and its buffers — ackurat.github.io">
      <meta property="og:description" content="PostgreSQL&#39;s buffer cache plays a crucial role in maintaining high performance. In this article, I conduct some experiments and show how the buffer cache affects performance.">
      <meta property="og:type" content="article">
      <meta property="og:url" content="https://ackurat.github.io/understanding-postgresql-buffers/">
      <meta name="twitter:card" content="summary">
      <meta name="twitter:title" content="Understanding PostgreSQL and its buffers — ackurat.github.io">
      <meta name="twitter:description" content="PostgreSQL&#39;s buffer cache plays a crucial role in maintaining high performance. In this article, I conduct some experiments and show how the buffer cache affects performance.">
      <meta itemprop="name" content="Understanding PostgreSQL and its buffers — ackurat.github.io">
      <meta itemprop="description" content="PostgreSQL&#39;s buffer cache plays a crucial role in maintaining high performance. In this article, I conduct some experiments and show how the buffer cache affects performance.">
      
        <meta itemprop="datePublished" content="2025-02-07T06:00:00Z">
        <meta itemprop="dateModified" content="2025-02-07T06:00:00Z">
        <meta itemprop="wordCount" content="269">
        <meta itemprop="keywords" content="postgres,database">
        <meta property="article:author" content="Adam CL">
        <meta property="article:section" content="Software">
        <meta property="article:tag" content="postgres"><meta property="article:tag" content="database">
        <meta property="article:published_time" content="2025-02-07T06:00:00Z">
        <meta property="article:modified_time" content="2025-02-07T06:00:00Z">
      
      <link rel="canonical" href="https://ackurat.github.io/understanding-postgresql-buffers/">
      <link rel="stylesheet" href="/assets/app.css">
    </head>
    <body>
      <div class="container mx-auto px-4">
        <header class="flex justify-center py-4 text-lg font-bold tracking-wider">
          <div class="flex space-x-4 pb-6">
            <a href="/">Home</a>
            <a href="/about/">About</a>
            <a href="/archive/">Archive</a>
            <a href="/reads/">Reads</a>
            <a type="application/rss+xml" href="/index.xml">RSS</a>
          </div>
        </header>
        <main class="flex justify-center">
          <div class="w-full md:w-1/2">
            
  <div class="flex flex-col">
    <span class="text-base">Feb 7, 2025</span>
    <span class="text-3xl">Understanding PostgreSQL and its buffers</span>
  </div>
  <article class="text-xl">
    <p>PostgreSQL&#39;s buffer cache plays a crucial role in maintaining high performance. In this article, I conduct some experiments and show how the buffer cache affects performance.</p>
    <h2 id="quick-intro-to-postgresql">
<a href="#quick-intro-to-postgresql">Quick Intro to PostgreSQL</a></h2>
<p>
<a href="https://www.postgresql.org/">PostgreSQL</a> is an open source relational database engine. It has been around for some 35 years, is highly performant, scalable through replication and is widely used. Major cloud providers offer managed solutions for Postgres, with additions such as automatic failover and recover and automatic maintenance.</p>
<h2 id="what-is-the-buffer-cache">
<a href="#what-is-the-buffer-cache">What is the Buffer Cache?</a></h2>
<p>
The buffer cache is, simply put, a caching mechanism to speed up reading of data. Since Postgres stores data on disk, any I/O reads to the storage layer will incur extra delay. The cache on the other hand lives in memory, providing much lower delay. The performance difference is an order of magnitude, something we’ll see later in this post.</p>
<p>
There is more than one cache in Postgres, but in this post I’ll only focus on <code class="inline">shared_buffers</code>, which is the main cache for reading data.</p>
<h3>
Structure of shared_buffers</h3>
<p>
The smallest unit in Postgres is a <code class="inline">page</code>, defaulting to 8kB. A row of data in a table will be stored in at least one page - if the size of the row exceeds the page size, it will be distributed among multiple pages. Simple stuff.</p>
<p>
The <code class="inline">shared_buffers</code> will only cache pages. The implication of this is that rows that hasn’t been read might be cached, since neighbouring (page-wise) rows have been read.</p>
<h2 id="experimenting-with-the-cache">
<a href="#experimenting-with-the-cache">Experimenting with the Cache</a></h2>
<p>
Let’s start by enabling an extension which will allow us to read the contents of the cache:</p>
<pre><code class="makeup sql"><span class="kr">create</span><span class="w"> </span><span class="n">extension</span><span class="w"> </span><span class="n">pg_buffercache</span><span class="p">;</span><span class="w">

</span><span class="kr">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="kr">table</span><span class="p">;</span></code></pre>

  </article>
  <hr class="my-4">
  <footer>
    
    <div class="flex justify-between">
      
        <a href="/once-again-rewriting-the-site">
          Previous
        </a>
      
      
        <a href="/exploring-gleam-through-advent-of-code">
          Next
        </a>
      
    </div>
  
    
  </footer>
  
          </div>
        </main>
      </div>
    </body>
  </html>