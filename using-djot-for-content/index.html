<!DOCTYPE html>
  <html lang="en">
    <head>
      <meta charset="utf-8">
      <title>Using Djot for Content — ackurat.github.io</title>
      <meta name="description" content="My site now has Djot support, which will make it easier to implement some microfeatures such as inline code highlighting and footnotes.">
      <meta name="author" content="Adam CL">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link href="/index.xml" rel="alternate" type="application/rss+xml" title="ackurat.github.io">
      <meta name="ROBOTS" content="INDEX, FOLLOW">
      <meta property="og:title" content="Using Djot for Content — ackurat.github.io">
      <meta property="og:description" content="My site now has Djot support, which will make it easier to implement some microfeatures such as inline code highlighting and footnotes.">
      <meta property="og:type" content="article">
      <meta property="og:url" content="https://ackurat.github.io/using-djot-for-content/">
      <meta name="twitter:card" content="summary">
      <meta name="twitter:title" content="Using Djot for Content — ackurat.github.io">
      <meta name="twitter:description" content="My site now has Djot support, which will make it easier to implement some microfeatures such as inline code highlighting and footnotes.">
      <meta itemprop="name" content="Using Djot for Content — ackurat.github.io">
      <meta itemprop="description" content="My site now has Djot support, which will make it easier to implement some microfeatures such as inline code highlighting and footnotes.">
      
        <meta itemprop="datePublished" content="2025-02-18T06:00:00Z">
        <meta itemprop="dateModified" content="2025-02-18T06:00:00Z">
        <meta itemprop="wordCount" content="289">
        <meta itemprop="keywords" content="djot,elixir">
        <meta property="article:author" content="Adam CL">
        <meta property="article:section" content="Software">
        <meta property="article:tag" content="djot"><meta property="article:tag" content="elixir">
        <meta property="article:published_time" content="2025-02-18T06:00:00Z">
        <meta property="article:modified_time" content="2025-02-18T06:00:00Z">
      
      <link rel="canonical" href="https://ackurat.github.io/using-djot-for-content/">
      <link rel="stylesheet" href="/assets/app.css">
      <script>
        (function() {
          const storedTheme = localStorage.getItem('theme');
          const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
          const theme = storedTheme || systemTheme;

          document.documentElement.style.colorScheme = theme;
          document.documentElement.classList.add(theme);

          const storedContrast = localStorage.getItem('highContrast') === 'true';
          const systemContrast = window.matchMedia('(prefers-contrast: more)').matches ? 'hc' : '';
          const contrast = storedContrast || systemContrast;
          if (contrast) {
            document.documentElement.classList.add('hc');
          }
        })();
      </script>
      
        <script data-goatcounter="https://ackurat.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
      
    </head>
    <body class="bg-latte-crust dark:bg-macchiato-base hc:bg-white hc:dark:bg-black text-latte-text dark:text-macchiato-text hc:text-black hc:dark:text-white min-h-screen font-sans">
        <header class="flex justify-center py-4" id="top">
            <nav class="flex justify-between items-center gap-4 pb-6 px-2 text-lg font-bold tracking-wider w-full max-w-2xl">
                <a href="/">~/</a>
                <div class="flex flex-wrap gap-4">
                    <a href="/about/">About</a>
                    <a href="/archive/">Archive</a>
                    <a type="application/rss+xml" href="/index.xml" alt="RSS feed" aria-label="RSS feed">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-[1em] w-auto inline-block align-middle -mt-0.5" viewBox="0 0 24 24" aria-label="RSS icon with radio waves emanating from a dot in the lower left">
                        <!-- Icon from Logos free icons by Streamline - https://creativecommons.org/licenses/by/4.0/ -->
                            <g fill="currentColor" stroke="none" stroke-linejoin="round">
                                <path d="M1.5 19.5a3 3 0 1 0 6 0a3 3 0 1 0-6 0"></path>
                                <path d="M12.5 22.5c0-6.075-4.925-11-11-11v-3c7.732 0 14 6.268 14 14z" clip-rule="evenodd"></path>
                                <path d="M19.5 22.5c0-9.941-8.059-18-18-18v-3c11.598 0 21 9.402 21 21z" clip-rule="evenodd"></path>
                            </g>
                        </svg>
                    </a>
                    <button id="theme-toggle" class="cursor-pointer hover:opacity-70 transition-opacity" aria-label="Toggle theme">
                        <span id="theme-icon"></span>
                    </button>
                    <button id="contrast-toggle" class="cursor-pointer hover:opacity-70 transition-opacity" aria-label="Toggle high contrast">
                        <span id="contrast-icon"></span>
                    </button>
                </div>
            </nav>
        </header>
        <main class="w-full">
            
  

  <div class="flex justify-center px-4">
  <div class="w-full max-w-2xl">
    
    <article class="text-l">
      <div class="flex flex-col mb-6">
        <span class="text-base">Feb 18, 2025</span>
        <h1 class="text-3xl">Using Djot for Content</h1>
        <div>
          <a class="text-base mr-2" href="/keywords/djot">djot</a><a class="text-base mr-2" href="/keywords/elixir">elixir</a>
        </div>
      </div>

      <html><head></head><body><p>I’ve just set up the site to handle both <a href="https://djot.net">Djot</a> and Markdown for writing content. It was surprisingly easy! This post outlines how to do it using <a href="https://hexdocs.pm/nimble_publisher/">NimblePublisher</a> and a <a href="https://hexdocs.pm/djot/">Djot</a> parser.</p>
<p>We can <a href="https://hexdocs.pm/nimble_publisher/NimblePublisher.html#module-custom-html-converter">override</a> the HTML converter used by NimblePublisher by simply plugging in our own. Our converter needs to implement the <code class="language-plaintext" translate="no">convert/4
</code> function which returns the HTML as a string.</p>
<pre class="athl athl-themes relative rounded-lg p-2 light dark" style="color: light-dark(#4c4f69, #cdd6f4); background-color: light-dark(#eff1f5, #1e1e2e);"><span class="absolute top-0 right-4 -translate-y-full rounded-t-lg px-2 text-base" style="background-color: light-dark(var(--color-latte-base), var(--color-mocha-base)); color: light-dark(var(--color-latte-text), var(--color-mocha-text));">elixir</span><code class="language-elixir block overflow-x-auto" translate="no" tabindex="0" role="code"><div class="line" data-line="1"><span style="color: light-dark(#8839ef, #cba6f7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">defmodule</span> <span style="color: light-dark(#df8e1d, #f9e2af); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">Convert</span> <span style="color: light-dark(#8839ef, #cba6f7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">do</span>
</div><div class="line" data-line="2">  <span style="color: light-dark(#8839ef, #cba6f7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">def</span> <span style="color: light-dark(#1e66f5, #89b4fa); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">convert</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">(</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">_path</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">,</span> <span style="color: light-dark(#4c4f69, #cdd6f4); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">body</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">,</span> <span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">_attrs</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">,</span> <span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">_optds</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">)</span> <span style="color: light-dark(#8839ef, #cba6f7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">do</span>
</div><div class="line" data-line="3">    <span style="color: light-dark(#df8e1d, #f9e2af); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">Djot</span><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">.</span><span style="color: light-dark(#1e66f5, #89b4fa); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">to_html!</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">(</span><span style="color: light-dark(#4c4f69, #cdd6f4); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">body</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">)</span>
</div><div class="line" data-line="4">  <span style="color: light-dark(#8839ef, #cba6f7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">end</span>
</div><div class="line" data-line="5"><span style="color: light-dark(#8839ef, #cba6f7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">end</span>
</div></code></pre>
<p>Since Djot is more or less a superset of Markdown, all previous content can be rendered successfully with the Djot parser. With the default HTML converter now defunct, NimblePublisher won’t apply the code highlighter, so we’ll need to add this to our <code class="language-plaintext" translate="no">convert/4
</code> function. Let’s create two small helpers, one to apply highlighting to all block code and one to inline code:</p>
<pre class="athl athl-themes relative rounded-lg p-2 light dark" style="color: light-dark(#4c4f69, #cdd6f4); background-color: light-dark(#eff1f5, #1e1e2e);"><span class="absolute top-0 right-4 -translate-y-full rounded-t-lg px-2 text-base" style="background-color: light-dark(var(--color-latte-base), var(--color-mocha-base)); color: light-dark(var(--color-latte-text), var(--color-mocha-text));">elixir</span><code class="language-elixir block overflow-x-auto" translate="no" tabindex="0" role="code"><div class="line" data-line="1"><span style="color: light-dark(#8839ef, #cba6f7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">defp</span> <span style="color: light-dark(#1e66f5, #89b4fa); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">highlight_block_code</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">(</span><span style="color: light-dark(#4c4f69, #cdd6f4); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">body</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">)</span> <span style="color: light-dark(#8839ef, #cba6f7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">do</span>
</div><div class="line" data-line="2">  <span style="color: light-dark(#4c4f69, #cdd6f4); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">block_code</span> <span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">=</span> <span style="color: light-dark(#ea76cb, #f5c2e7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">~</span>r/&lt;pre&gt;&lt;code<span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">(?:</span></span><span style="color: light-dark(#ea76cb, #f5c2e7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">\s</span><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">+</span></span>class=&quot;language-<span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">(</span></span><span style="color: light-dark(#ea76cb, #f5c2e7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"></span><span style="color: light-dark(#ea76cb, #f5c2e7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">\w</span><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">*</span></span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">)</span></span>&quot;<span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">)</span></span><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">?</span></span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">&gt;</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">(</span></span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">[</span></span>^<span style="color: light-dark(#fe640b, #fab387); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#fe640b, #fab387); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">&lt;</span></span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">]</span></span><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">*</span></span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">)</span></span>&lt;<span style="color: light-dark(#ea76cb, #f5c2e7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">\/</span>code&gt;&lt;<span style="color: light-dark(#ea76cb, #f5c2e7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">\/</span>pre&gt;/
</div><div class="line" data-line="3">
</div><div class="line" data-line="4">  <span style="color: light-dark(#df8e1d, #f9e2af); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">NimblePublisher</span><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">.</span><span style="color: light-dark(#1e66f5, #89b4fa); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">highlight</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">(</span><span style="color: light-dark(#4c4f69, #cdd6f4); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">body</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">,</span> <span style="color: light-dark(#dd7878, #f2cdcd); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">regex: </span><span style="color: light-dark(#4c4f69, #cdd6f4); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">block_code</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">)</span>
</div><div class="line" data-line="5"><span style="color: light-dark(#8839ef, #cba6f7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">end</span>
</div><div class="line" data-line="6">
</div><div class="line" data-line="7"><span style="color: light-dark(#8839ef, #cba6f7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">defp</span> <span style="color: light-dark(#1e66f5, #89b4fa); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">highlight_inline_code</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">(</span><span style="color: light-dark(#4c4f69, #cdd6f4); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">body</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">)</span> <span style="color: light-dark(#8839ef, #cba6f7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">do</span>
</div><div class="line" data-line="8">  <span style="color: light-dark(#4c4f69, #cdd6f4); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">inline_code</span> <span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">=</span> <span style="color: light-dark(#ea76cb, #f5c2e7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">~</span>r/<span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">(?&lt;</span></span><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">!</span></span>&lt;pre&gt;<span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">)</span></span>&lt;code<span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">(?:</span></span><span style="color: light-dark(#ea76cb, #f5c2e7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">\s</span><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">+</span></span>class=&quot;language-<span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">(</span></span><span style="color: light-dark(#ea76cb, #f5c2e7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"></span><span style="color: light-dark(#ea76cb, #f5c2e7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">\w</span><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">*</span></span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">)</span></span>&quot;<span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">)</span></span><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">?</span></span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">&gt;</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">(</span></span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">[</span></span>^<span style="color: light-dark(#fe640b, #fab387); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#fe640b, #fab387); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">&lt;</span></span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">]</span></span><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">*</span></span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">)</span></span>&lt;<span style="color: light-dark(#ea76cb, #f5c2e7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">\/</span>code&gt;/
</div><div class="line" data-line="9">
</div><div class="line" data-line="10">  <span style="color: light-dark(#df8e1d, #f9e2af); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">Regex</span><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">.</span><span style="color: light-dark(#1e66f5, #89b4fa); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">replace</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">(</span><span style="color: light-dark(#4c4f69, #cdd6f4); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">inline_code</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">,</span> <span style="color: light-dark(#4c4f69, #cdd6f4); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">body</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">,</span> <span style="color: light-dark(#8839ef, #cba6f7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">fn</span> <span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">(</span><span style="color: light-dark(#4c4f69, #cdd6f4); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">block</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">,</span> <span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">_lang</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">,</span> <span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">_code</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">)</span> <span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">-&gt;</span>
</div><div class="line" data-line="11">    <span style="color: light-dark(#df8e1d, #f9e2af); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">NimblePublisher</span><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">.</span><span style="color: light-dark(#1e66f5, #89b4fa); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">highlight</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">(</span><span style="color: light-dark(#4c4f69, #cdd6f4); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">block</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">,</span> <span style="color: light-dark(#dd7878, #f2cdcd); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">regex: </span><span style="color: light-dark(#4c4f69, #cdd6f4); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">inline_code</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">)</span>
</div><div class="line" data-line="12">    <span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">|&gt;</span> <span style="color: light-dark(#df8e1d, #f9e2af); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">String</span><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">.</span><span style="color: light-dark(#1e66f5, #89b4fa); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">replace</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">(</span><span style="color: light-dark(#ea76cb, #f5c2e7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">~</span>r/&lt;pre&gt;<span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">(</span></span><span style="color: light-dark(#d20f39, #f38ba8); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#d20f39, #f38ba8); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">.</span></span><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#04a5e5, #89dceb); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">*</span></span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);"><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">)</span></span>&lt;<span style="color: light-dark(#ea76cb, #f5c2e7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">\/</span>pre&gt;/s<span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">,</span> <span style="color: light-dark(#40a02b, #a6e3a1); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">&quot;<span style="color: light-dark(#ea76cb, #f5c2e7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">\\</span>1&quot;</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">)</span>
</div><div class="line" data-line="13">  <span style="color: light-dark(#8839ef, #cba6f7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">end</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">)</span>
</div><div class="line" data-line="14"><span style="color: light-dark(#8839ef, #cba6f7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">end</span>
</div></code></pre>
<p>Now we can just pipe the HTML output from the parser through these functions, and we’ll get highlighting. There are a few considerations:</p>
<ul>
<li>
We need the new regexes since the default used in <code class="language-plaintext" translate="no">NimblePublisher.highlight/2
</code> doesn’t match anymore - the Djot parser uses an attribute like <code class="language-html" translate="no">class=&quot;language-elixir&quot;
</code>.
</li>
<li>
The library I use for highlighting, <a href="https://hexdocs.pm/makeup/">Makeup</a> adds <code class="language-html" translate="no"><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">&lt;</span><span style="color: light-dark(#1e66f5, #89b4fa); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">pre</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">&gt;</span>
</code> tags around code. This messes up the inline code, hence the replace code to remove them.
</li>
</ul>
<p>All that is left to do now is tell NimblePublisher to use the converter, both on markdown and djot:</p>
<pre class="athl athl-themes relative rounded-lg p-2 light dark" style="color: light-dark(#4c4f69, #cdd6f4); background-color: light-dark(#eff1f5, #1e1e2e);"><span class="absolute top-0 right-4 -translate-y-full rounded-t-lg px-2 text-base" style="background-color: light-dark(var(--color-latte-base), var(--color-mocha-base)); color: light-dark(var(--color-latte-text), var(--color-mocha-text));">elixir</span><code class="language-elixir block overflow-x-auto" translate="no" tabindex="0" role="code"><div class="line" data-line="1"><span style="color: light-dark(#8839ef, #cba6f7); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">use</span> <span style="color: light-dark(#df8e1d, #f9e2af); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">NimblePublisher</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">,</span>
</div><div class="line" data-line="2">  <span style="color: light-dark(#dd7878, #f2cdcd); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">from: </span><span style="color: light-dark(#40a02b, #a6e3a1); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">&quot;./pages/**/*.{md,dj}&quot;</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">,</span>
</div><div class="line" data-line="3">  <span style="color: light-dark(#dd7878, #f2cdcd); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">highlighters: </span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">[</span><span style="color: light-dark(#dd7878, #f2cdcd); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">:makeup_elixir</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">]</span><span style="color: light-dark(#7c7f93, #9399b2); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">,</span>
</div><div class="line" data-line="4">  <span style="color: light-dark(#dd7878, #f2cdcd); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">html_converter: </span><span style="color: light-dark(#df8e1d, #f9e2af); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">Convert</span>
</div><div class="line" data-line="5">  <span style="color: light-dark(#4c4f69, #cdd6f4); font-weight: light-dark(normal, normal); text-decoration: light-dark(none, none);">...</span>
</div></code></pre>
</body></html>
    </article>

    <div class="-mx-4 my-2 flex h-1 w-screen rounded-full sm:mx-0 sm:w-full bg-linear-to-r dark:from-footer-dark-1 from-footer-light-1 dark:via-footer-dark-2 via-footer-light-2 dark:to-footer-dark-3 to-footer-light-3"></div>
  <footer class="italic">
    
      <div class="flex justify-between">
        
          <a href="/one-year-retrospective-of-elixir">
            Previous
          </a>
        
        
          <a href="/once-again-rewriting-the-site">
            Next
          </a>
        
      </div>
    
  </footer>
  
  </div>
</div>

  <script>
  (function() {
    let lastHash = location.hash;

    function updateTOC(sectionId) {
      document.querySelectorAll('[data-toc-link]').forEach(function(link) {
        link.setAttribute('data-active', link.dataset.tocLink === sectionId);
      });
    }

    document.addEventListener('scroll', function() {
      const sections = document.querySelectorAll('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id], section[id]');
      let currentSection = null;

      sections.forEach(function(section) {
        if (window.scrollY >= section.offsetTop - 100) {
          currentSection = section;
        }
      });

      // If at bottom of page, use the last section
      if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 10) {
        currentSection = sections[sections.length - 1];
      }

      if (currentSection && currentSection.id) {
        const newHash = '#' + currentSection.id;
        if (lastHash !== newHash) {
          history.replaceState(null, '', location.origin + location.pathname + newHash);
          lastHash = newHash;
          updateTOC(currentSection.id);
        }
      }
    });

    if (location.hash) {
      updateTOC(decodeURIComponent(location.hash.substring(1)));
    }
  })();
</script>

        </main>
        <script>
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            const contrastToggle = document.getElementById('contrast-toggle');
            const contrastIcon = document.getElementById('contrast-icon');
            const html = document.documentElement;

            function updateThemeIcon() {
              const currentTheme = html.style.colorScheme ||
                  (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
              themeIcon.textContent = currentTheme === 'dark' ? '☼' : '☾';
            }

            function updateContrastIcon() {
              const isHighContrast = html.classList.contains('hc');
              contrastIcon.textContent = isHighContrast ? '◑' : '◐';
            }

            updateThemeIcon();
            updateContrastIcon();

            themeToggle.addEventListener('click', () => {
              const currentTheme = html.style.colorScheme ||
                  (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
              const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
              html.style.colorScheme = newTheme;
              html.classList.remove('light', 'dark');
              html.classList.add(newTheme);
              localStorage.setItem('theme', newTheme);
              updateThemeIcon();
            });

            contrastToggle.addEventListener('click', () => {
              const isHighContrast = html.classList.contains('hc');
              if (isHighContrast) {
                html.classList.remove('hc');
                localStorage.setItem('highContrast', 'false');
              } else {
                html.classList.add('hc');
                localStorage.setItem('highContrast', 'true');
              }
              updateContrastIcon();
            });

        </script>


    </body>
  </html>